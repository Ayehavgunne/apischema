


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.0">
    
    
      
        <title>Data model and resolvers - apischema</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.b5d04df8.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.9ab2c1f8.min.css">
      
      
        
        
        <meta name="theme-color" content="#4caf50">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="green" data-md-color-accent="indigo">
  
    
      <script>matchMedia("(prefers-color-scheme: dark)").matches&&document.body.setAttribute("data-md-color-scheme","slate")</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#data-model-and-resolvers" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="apischema" class="md-header-nav__button md-logo" aria-label="apischema">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            apischema
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Data model and resolvers
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/wyfo/apischema/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    wyfo/apischema
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="apischema" class="md-nav__button md-logo" aria-label="apischema">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    apischema
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/wyfo/apischema/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    wyfo/apischema
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../data_model/" title="Data model" class="md-nav__link">
      Data model
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../de_serialization/" title="(De)serialization" class="md-nav__link">
      (De)serialization
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../json_schema/" title="JSON schema" class="md-nav__link">
      JSON schema
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../validation/" title="Validation" class="md-nav__link">
      Validation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../conversions/" title="Conversions" class="md-nav__link">
      Conversions
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      GraphQL
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="GraphQL" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        GraphQL
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Data model and resolvers
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Data model and resolvers" class="md-nav__link md-nav__link--active">
      Data model and resolvers
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#restrictions" class="md-nav__link">
    Restrictions
  </a>
  
    <nav class="md-nav" aria-label="Restrictions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#typeddict" class="md-nav__link">
    TypedDict
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#union" class="md-nav__link">
    Union
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#non-null" class="md-nav__link">
    Non-null
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#undefined" class="md-nav__link">
    Undefined
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interfaces" class="md-nav__link">
    Interfaces
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resolvers" class="md-nav__link">
    Resolvers
  </a>
  
    <nav class="md-nav" aria-label="Resolvers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#graphqlresolveinfo-parameter" class="md-nav__link">
    GraphQLResolveInfo parameter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#undefined-parameter-default-null-vs-undefined" class="md-nav__link">
    Undefined parameter default — null vs. undefined
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    Error handling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters-metadata" class="md-nav__link">
    Parameters metadata
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#id-type" class="md-nav__link">
    ID type
  </a>
  
    <nav class="md-nav" aria-label="ID type">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#id-encoding" class="md-nav__link">
    ID encoding
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tagged-unions" class="md-nav__link">
    Tagged unions
  </a>
  
    <nav class="md-nav" aria-label="Tagged unions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json-schema" class="md-nav__link">
    JSON schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graphql-schema" class="md-nav__link">
    GraphQL schema
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../schema/" title="GraphQL schema" class="md-nav__link">
      GraphQL schema
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../relay/" title="Relay" class="md-nav__link">
      Relay
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Examples
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Examples" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/open_rpc/" title="OpenRPC" class="md-nav__link">
      OpenRPC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/sqlalchemy_support/" title="SQLAlchemy support" class="md-nav__link">
      SQLAlchemy support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/pydantic_support/" title="Pydantic support" class="md-nav__link">
      Pydantic support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/attrs_support/" title="Attrs support" class="md-nav__link">
      Attrs support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/subclasses_union/" title="Class as union of its subclasses" class="md-nav__link">
      Class as union of its subclasses
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../examples/recoverable_fields/" title="Recoverable fields" class="md-nav__link">
      Recoverable fields
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../benchmark/" title="Benchmark" class="md-nav__link">
      Benchmark
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../difference_with_pydantic/" title="Difference with pydantic" class="md-nav__link">
      Difference with pydantic
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://github.com/wyfo/apischema/releases" title="Releases" class="md-nav__link">
      Releases
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#restrictions" class="md-nav__link">
    Restrictions
  </a>
  
    <nav class="md-nav" aria-label="Restrictions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#typeddict" class="md-nav__link">
    TypedDict
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#union" class="md-nav__link">
    Union
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#non-null" class="md-nav__link">
    Non-null
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#undefined" class="md-nav__link">
    Undefined
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interfaces" class="md-nav__link">
    Interfaces
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resolvers" class="md-nav__link">
    Resolvers
  </a>
  
    <nav class="md-nav" aria-label="Resolvers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#graphqlresolveinfo-parameter" class="md-nav__link">
    GraphQLResolveInfo parameter
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#undefined-parameter-default-null-vs-undefined" class="md-nav__link">
    Undefined parameter default — null vs. undefined
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    Error handling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parameters-metadata" class="md-nav__link">
    Parameters metadata
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#id-type" class="md-nav__link">
    ID type
  </a>
  
    <nav class="md-nav" aria-label="ID type">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#id-encoding" class="md-nav__link">
    ID encoding
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tagged-unions" class="md-nav__link">
    Tagged unions
  </a>
  
    <nav class="md-nav" aria-label="Tagged unions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json-schema" class="md-nav__link">
    JSON schema
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graphql-schema" class="md-nav__link">
    GraphQL schema
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/wyfo/apischema/edit/master/docs/graphql/data_model_and_resolvers.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="data-model-and-resolvers">Data model and resolvers<a class="headerlink" href="#data-model-and-resolvers" title="Permanent link">&para;</a></h1>
<p>Almost everything of the <a href="../../data_model/">Data model section</a> remains valid in <em>GraphQL</em> integration.</p>
<h2 id="restrictions">Restrictions<a class="headerlink" href="#restrictions" title="Permanent link">&para;</a></h2>
<h3 id="typeddict"><code>TypedDict</code><a class="headerlink" href="#typeddict" title="Permanent link">&para;</a></h3>
<p><code>TypedDict</code> is not supported in output type. In fact, typed dicts are not real classes, so their type can not be checked at runtime, but this is required to disambiguate unions/interfaces.</p>
<h3 id="union"><code>Union</code><a class="headerlink" href="#union" title="Permanent link">&para;</a></h3>
<p>Unions are only supported between <strong>output</strong> object type, which means <code>dataclass</code> and <code>NamedTuple</code> (and <a href="../../conversions/">conversions</a>/<a href="../../conversions/#dataclass-model---automatic-conversion-fromto-dataclass">dataclass model</a>).</p>
<p>There are 2 exceptions which can be always be used in <code>Union</code>:</p>
<ul>
<li><code>None</code>/<code>Optional</code>: Types are non-null (marked with an exclamation mark <code>!</code> in <em>GraphQL</em> schema) by default; <code>Optional</code> types however results in normal <em>GraphQL</em> types (without <code>!</code>).</li>
<li><code>apischema.UndefinedType</code>: it is simply ignored. It is useful in resolvers, see <a href="#undefined_param_default">following section</a></li>
</ul>
<h2 id="non-null">Non-null<a class="headerlink" href="#non-null" title="Permanent link">&para;</a></h2>
<p>Types are assumed to be non-null by default, as in Python typing. Nullable types are obtained using <code>typing.Optional</code> (or <code>typing.Union</code> with a <code>None</code> argument).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is one exception, when resolver parameter default value is not serializable (and thus cannot be included in the schema), parameter type is then set as nullable to make the parameter non-required. For example parameters not <code>Optional</code> but with <code>Undefined</code> default value will be marked as nullable. This is only for the schema, default value is still used at execution.</p>
</div>
<h2 id="undefined">Undefined<a class="headerlink" href="#undefined" title="Permanent link">&para;</a></h2>
<p>In output, <code>Undefined</code> is converted to <code>None</code>; so in the schema, <code>Union[T, UndefinedType]</code> will be nullable.</p>
<p>In input, fields become nullable when <code>Undefined</code> is their default value.</p>
<h2 id="interfaces">Interfaces<a class="headerlink" href="#interfaces" title="Permanent link">&para;</a></h2>
<p>Interfaces are simply classes marked with <code>apischema.graphql.interface</code> decorator. An object type implements an interface when its class inherits of interface-marked class, or when it has <a href="../../data_model/#composed-dataclasses-merging">merged fields</a> of interface-marked dataclass.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">graphql</span> <span class="kn">import</span> <span class="n">print_schema</span>

<span class="kn">from</span> <span class="nn">apischema.graphql</span> <span class="kn">import</span> <span class="n">graphql_schema</span><span class="p">,</span> <span class="n">interface</span>


<span class="nd">@interface</span>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Bar</span><span class="p">:</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">int</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">Bar</span><span class="p">):</span>
    <span class="n">baz</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">def</span> <span class="nf">foo</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Foo</span><span class="p">]:</span>
    <span class="o">...</span>


<span class="n">schema</span> <span class="o">=</span> <span class="n">graphql_schema</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="p">[</span><span class="n">foo</span><span class="p">])</span>
<span class="n">schema_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">type Query {</span>
<span class="s2">  foo: Foo</span>
<span class="s2">}</span>

<span class="s2">type Foo implements Bar {</span>
<span class="s2">  bar: Int!</span>
<span class="s2">  baz: String!</span>
<span class="s2">}</span>

<span class="s2">interface Bar {</span>
<span class="s2">  bar: Int!</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="k">assert</span> <span class="n">print_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span> <span class="o">==</span> <span class="n">schema_str</span>
</code></pre></div>

<h2 id="resolvers">Resolvers<a class="headerlink" href="#resolvers" title="Permanent link">&para;</a></h2>
<p>All <code>dataclass</code>/<code>NamedTuple</code> fields (excepted <a href="../../data_model/#skip-dataclass-field">skipped</a>) are resolved with their <a href="../../json_schema/#field-alias">alias</a> in the <em>GraphQL</em> schema.</p>
<p>Custom resolvers can also be added by marking methods with <code>apischema.graphql.resolver</code> decorator — resolvers share a common interface with <a href="../../de_serialization/#serialized-methodsproperties"><code>apischema.serialized</code></a>, with a few differences.</p>
<p>Methods can be synchronous or asynchronous (defined with <code>async def</code> or annotated with an <code>typing.Awaitable</code> return type).</p>
<p>Resolvers parameters are included in the schema with their type, and their default value.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">graphql</span> <span class="kn">import</span> <span class="n">print_schema</span>

<span class="kn">from</span> <span class="nn">apischema.graphql</span> <span class="kn">import</span> <span class="n">graphql_schema</span><span class="p">,</span> <span class="n">resolver</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Bar</span><span class="p">:</span>
    <span class="n">baz</span><span class="p">:</span> <span class="nb">int</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="nd">@resolver</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Bar</span><span class="p">:</span>
        <span class="o">...</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">foo</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Foo</span><span class="p">]:</span>
    <span class="o">...</span>


<span class="n">schema</span> <span class="o">=</span> <span class="n">graphql_schema</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="p">[</span><span class="n">foo</span><span class="p">])</span>
<span class="n">schema_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">type Query {</span>
<span class="s2">  foo: Foo</span>
<span class="s2">}</span>

<span class="s2">type Foo {</span>
<span class="s2">  bar(arg: Int! = 0): Bar!</span>
<span class="s2">}</span>

<span class="s2">type Bar {</span>
<span class="s2">  baz: Int!</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="k">assert</span> <span class="n">print_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span> <span class="o">==</span> <span class="n">schema_str</span>
</code></pre></div>

<h3 id="graphqlresolveinfo-parameter"><code>GraphQLResolveInfo</code> parameter<a class="headerlink" href="#graphqlresolveinfo-parameter" title="Permanent link">&para;</a></h3>
<p>Resolvers can have an additional parameter of type <a href="https://graphql-core-3.readthedocs.io/en/latest/modules/type.html?highlight=GraphQLResolveInfo#graphql.type.GraphQLResolveInfo"><code>graphql.GraphQLResolveInfo</code></a> (or <code>Optional[graphql.GraphQLResolveInfo]</code>), which is automatically injected when the resolver is executed in the context of a <em>GraphQL</em> request. This parameter contains the info about the current <em>GraphQL</em> request being executed.</p>
<h3 id="undefined-parameter-default-null-vs-undefined">Undefined parameter default — <code>null</code> vs. <code>undefined</code><a class="headerlink" href="#undefined-parameter-default-null-vs-undefined" title="Permanent link">&para;</a></h3>
<p><code>Undefined</code> can be used as default value of resolver parameters. It can be to distinguish a <code>null</code> input from an absent/<code>undefined</code> input. In fact, <code>null</code> value will result in a <code>None</code> argument where no value will use the default value, <code>Undefined</code> so.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">graphql</span> <span class="kn">import</span> <span class="n">graphql_sync</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">Undefined</span><span class="p">,</span> <span class="n">UndefinedType</span>
<span class="kn">from</span> <span class="nn">apischema.graphql</span> <span class="kn">import</span> <span class="n">graphql_schema</span>


<span class="k">def</span> <span class="nf">arg_is_absent</span><span class="p">(</span><span class="n">arg</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">UndefinedType</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Undefined</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">arg</span> <span class="ow">is</span> <span class="n">Undefined</span>


<span class="n">schema</span> <span class="o">=</span> <span class="n">graphql_schema</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="p">[</span><span class="n">arg_is_absent</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">graphql_sync</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="s2">&quot;{argIsAbsent(arg: null)}&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;argIsAbsent&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
<span class="k">assert</span> <span class="n">graphql_sync</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{argIsAbsent}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;argIsAbsent&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</code></pre></div>

<h3 id="error-handling">Error handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h3>
<p>Errors occurring in resolvers can be caught in a dedicated error handler registered with <code>error_handler</code> parameter. This function takes in parameters the exception, the object, the <a href="#graphqlresolveinfo-parameter">info</a> and the <em>kwargs</em> of the failing resolver; it can return a new value or raise the current or another exception — it can for example be used to log errors without throwing the complete serialization.</p>
<p>The resulting serialization type will be a <code>Union</code> of the normal type and the error handling type ; if the error handler always raises, use <a href="https://docs.python.org/3/library/typing.html#typing.NoReturn"><code>typing.NoReturn</code></a> annotation.</p>
<p><code>error_handler=None</code> correspond to a default handler which only return <code>None</code> — exception is thus discarded and the resolver type becomes <code>Optional</code>.</p>
<p>The error handler is only executed by <em>apischema</em> serialization process, it's not added to the function, so this one can be executed normally and raise an exception in the rest of your code.</p>
<p>Error handler can be synchronous or asynchronous.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">logging</span> <span class="kn">import</span> <span class="n">getLogger</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="kn">import</span> <span class="nn">graphql</span>
<span class="kn">from</span> <span class="nn">graphql.utilities</span> <span class="kn">import</span> <span class="n">print_schema</span>

<span class="kn">from</span> <span class="nn">apischema.graphql</span> <span class="kn">import</span> <span class="n">graphql_schema</span><span class="p">,</span> <span class="n">resolver</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">log_error</span><span class="p">(</span>
    <span class="n">error</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">info</span><span class="p">:</span> <span class="n">graphql</span><span class="o">.</span><span class="n">GraphQLResolveInfo</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
        <span class="s2">&quot;Resolve error in </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">as_list</span><span class="p">())),</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">error</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="nd">@resolver</span><span class="p">(</span><span class="n">error_handler</span><span class="o">=</span><span class="n">log_error</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Bar error&quot;</span><span class="p">)</span>

    <span class="nd">@resolver</span>
    <span class="k">def</span> <span class="nf">baz</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Baz error&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">foo</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Foo</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">Foo</span><span class="p">()</span>


<span class="n">schema</span> <span class="o">=</span> <span class="n">graphql_schema</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="p">[</span><span class="n">foo</span><span class="p">])</span>
<span class="c1"># Notice that bar is Int while baz is Int!</span>
<span class="n">schema_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">type Query {</span>
<span class="s2">  foo: Foo!</span>
<span class="s2">}</span>

<span class="s2">type Foo {</span>
<span class="s2">  bar: Int</span>
<span class="s2">  baz: Int!</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="k">assert</span> <span class="n">print_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span> <span class="o">==</span> <span class="n">schema_str</span>
<span class="c1"># Logs &quot;Resolve error in foo.bar&quot;, no error raised</span>
<span class="k">assert</span> <span class="n">graphql</span><span class="o">.</span><span class="n">graphql_sync</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="s2">&quot;{foo</span><span class="si">{bar}</span><span class="s2">}&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}}</span>
<span class="c1"># Error is raised</span>
<span class="k">assert</span> <span class="n">graphql</span><span class="o">.</span><span class="n">graphql_sync</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="s2">&quot;{foo</span><span class="si">{baz}</span><span class="s2">}&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">message</span> <span class="o">==</span> <span class="s2">&quot;Baz error&quot;</span>
</code></pre></div>

<h3 id="parameters-metadata">Parameters metadata<a class="headerlink" href="#parameters-metadata" title="Permanent link">&para;</a></h3>
<p>Resolvers parameters can have metadata like dataclass fields. They can be passed using <code>typing.Annotated</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">graphql.utilities</span> <span class="kn">import</span> <span class="n">print_schema</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">alias</span><span class="p">,</span> <span class="n">schema</span>
<span class="kn">from</span> <span class="nn">apischema.graphql</span> <span class="kn">import</span> <span class="n">graphql_schema</span><span class="p">,</span> <span class="n">resolver</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="nd">@resolver</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">alias</span><span class="p">(</span><span class="s2">&quot;arg&quot;</span><span class="p">)</span> <span class="o">|</span> <span class="n">schema</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;argument&quot;</span><span class="p">)]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">param</span>


<span class="k">def</span> <span class="nf">foo</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Foo</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">Foo</span><span class="p">()</span>


<span class="n">schema_</span> <span class="o">=</span> <span class="n">graphql_schema</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="p">[</span><span class="n">foo</span><span class="p">])</span>
<span class="c1"># Notice that bar is Int while baz is Int!</span>
<span class="n">schema_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s1">type Query {</span>
<span class="s1">  foo: Foo!</span>
<span class="s1">}</span>

<span class="s1">type Foo {</span>
<span class="s1">  bar(</span>
<span class="s1">    &quot;&quot;&quot;argument&quot;&quot;&quot;</span>
<span class="s1">    param: Int!</span>
<span class="s1">  ): Int!</span>
<span class="s1">}</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="k">assert</span> <span class="n">print_schema</span><span class="p">(</span><span class="n">schema_</span><span class="p">)</span> <span class="o">==</span> <span class="n">schema_str</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p>Metadata can also be passed with <code>parameters_metadata</code> parameter; it takes a mapping of parameter names as key and mapped metadata as value.</p>
<h2 id="id-type">ID type<a class="headerlink" href="#id-type" title="Permanent link">&para;</a></h2>
<p><em>GraphQL</em> <code>ID</code> has no precise specification and is defined according API needs; it can be a UUID or and ObjectId, etc.</p>
<p><code>apischema.graphql_schema</code> has a parameter <code>id_types</code> which can be used to define which types will be marked as <code>ID</code> in the generated schema. Parameter value can be either a collection of types (each type will then be mapped to <code>ID</code> scalar), or a predicate returning if the given type must be marked as <code>ID</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>

<span class="kn">from</span> <span class="nn">graphql</span> <span class="kn">import</span> <span class="n">print_schema</span>

<span class="kn">from</span> <span class="nn">apischema.graphql</span> <span class="kn">import</span> <span class="n">graphql_schema</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">bar</span><span class="p">:</span> <span class="n">UUID</span>


<span class="k">def</span> <span class="nf">foo</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Foo</span><span class="p">]:</span>
    <span class="o">...</span>


<span class="c1"># id_types={UUID} is equivalent to id_types=lambda t: t in {UUID}</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">graphql_schema</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="p">[</span><span class="n">foo</span><span class="p">],</span> <span class="n">id_types</span><span class="o">=</span><span class="p">{</span><span class="n">UUID</span><span class="p">})</span>
<span class="n">schema_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">type Query {</span>
<span class="s2">  foo: Foo</span>
<span class="s2">}</span>

<span class="s2">type Foo {</span>
<span class="s2">  bar: ID!</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="k">assert</span> <span class="n">print_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span> <span class="o">==</span> <span class="n">schema_str</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>ID</code> type could also be identified using <code>typing.Annotated</code> and a predicate looking into annotations.</p>
</div>
<p><em>apischema</em> also provides a simple <code>ID</code> type with <code>apischema.graphql.ID</code>. It is just defined as a <code>NewType</code> of string, so you can use it when you want to manipulate raw <code>ID</code> strings in your resolvers.</p>
<h3 id="id-encoding">ID encoding<a class="headerlink" href="#id-encoding" title="Permanent link">&para;</a></h3>
<p><code>ID</code> encoding can directly be controlled the <code>id_encoding</code> parameters of <code>graphql_schema</code>. A current practice is to use <em>base64</em> encoding for <code>ID</code>.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64decode</span><span class="p">,</span> <span class="n">b64encode</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>

<span class="kn">from</span> <span class="nn">graphql</span> <span class="kn">import</span> <span class="n">graphql_sync</span>

<span class="kn">from</span> <span class="nn">apischema.graphql</span> <span class="kn">import</span> <span class="n">graphql_schema</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span>


<span class="k">def</span> <span class="nf">foo</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Foo</span><span class="p">]:</span>
    <span class="k">return</span> <span class="n">Foo</span><span class="p">(</span><span class="n">UUID</span><span class="p">(</span><span class="s2">&quot;58c88e87-5769-4723-8974-f9ec5007a38b&quot;</span><span class="p">))</span>


<span class="n">schema</span> <span class="o">=</span> <span class="n">graphql_schema</span><span class="p">(</span>
    <span class="n">query</span><span class="o">=</span><span class="p">[</span><span class="n">foo</span><span class="p">],</span>
    <span class="n">id_types</span><span class="o">=</span><span class="p">{</span><span class="n">UUID</span><span class="p">},</span>
    <span class="n">id_encoding</span><span class="o">=</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">b64decode</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span>
        <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">b64encode</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="k">assert</span> <span class="n">graphql_sync</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="s2">&quot;{foo</span><span class="si">{id}</span><span class="s2">}&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;NThjODhlODctNTc2OS00NzIzLTg5NzQtZjllYzUwMDdhMzhi&quot;</span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can also use <code>relay.base64_encoding</code> (see <a href="../relay/#id-encoding">next section</a>)</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>ID</code> serialization (respectively deserialization) is applied <strong>after</strong> <em>apischema</em> conversions (respectively before <em>apischema</em> conversion): in the example, uuid is already converted into string before being passed to <code>id_serializer</code>.</p>
<p>If you use base64 encodeing and an ID type which is converted by <em>apischema</em> to a base64 str, you will get a double encoded base64 string</p>
</div>
<h2 id="tagged-unions">Tagged unions<a class="headerlink" href="#tagged-unions" title="Permanent link">&para;</a></h2>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This feature has a provisional status, as the concerned <a href="https://github.com/graphql/graphql-spec/pull/733"><em>GraphQL</em> RFC</a> is not finalized.</p>
</div>
<p><em>apischema</em> provides a <code>apischema.tagged_unions.TaggedUnion</code> base class which helps to implement the <em>tagged union</em> pattern.
It's fields <strong>must</strong> be typed using <code>apischema.tagged_unions.Tagged</code> generic type.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">raises</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">Undefined</span><span class="p">,</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">deserialize</span><span class="p">,</span> <span class="n">serialize</span>
<span class="kn">from</span> <span class="nn">apischema.tagged_unions</span> <span class="kn">import</span> <span class="n">Tagged</span><span class="p">,</span> <span class="n">TaggedUnion</span><span class="p">,</span> <span class="n">get_tagged</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Bar</span><span class="p">:</span>
    <span class="n">field</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">TaggedUnion</span><span class="p">):</span>
    <span class="n">bar</span><span class="p">:</span> <span class="n">Tagged</span><span class="p">[</span><span class="n">Bar</span><span class="p">]</span>
    <span class="c1"># Tagged parameters can be used to customize the field like a dataclass one</span>
    <span class="n">baz</span><span class="p">:</span> <span class="n">Tagged</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tagged</span><span class="p">(</span>
        <span class="n">alias</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deserialization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">serialization</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span>


<span class="c1"># Instantiate using class fields</span>
<span class="n">tagged_bar</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">Bar</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">))</span>
<span class="c1"># you can also use default constructor, but it&#39;s not typed-checked</span>
<span class="k">assert</span> <span class="n">tagged_bar</span> <span class="o">==</span> <span class="n">Foo</span><span class="p">(</span><span class="n">bar</span><span class="o">=</span><span class="n">Bar</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">))</span>

<span class="c1"># All fields that are not tagged are Undefined</span>
<span class="k">assert</span> <span class="n">tagged_bar</span><span class="o">.</span><span class="n">bar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Undefined</span> <span class="ow">and</span> <span class="n">tagged_bar</span><span class="o">.</span><span class="n">baz</span> <span class="ow">is</span> <span class="n">Undefined</span>
<span class="c1"># get_tagged allows to retrieve the tag and it&#39;s value</span>
<span class="c1"># (but the value is not typed-checked)</span>
<span class="k">assert</span> <span class="n">get_tagged</span><span class="p">(</span><span class="n">tagged_bar</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="n">Bar</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">))</span>

<span class="c1"># (De)serialization works as expected</span>
<span class="k">assert</span> <span class="n">deserialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">}})</span> <span class="o">==</span> <span class="n">tagged_bar</span>
<span class="k">assert</span> <span class="n">serialize</span><span class="p">(</span><span class="n">tagged_bar</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">}}</span>

<span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="n">deserialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;unknown&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span>
<span class="k">assert</span> <span class="n">serialize</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="p">[{</span><span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;unknown&quot;</span><span class="p">],</span> <span class="s2">&quot;err&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;unexpected property&quot;</span><span class="p">]}]</span>

<span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="n">deserialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">},</span> <span class="s2">&quot;baz&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
<span class="k">assert</span> <span class="n">serialize</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s2">&quot;err&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;tagged union must have one and only one tag set, found [&#39;bar&#39;, &#39;baz&#39;]&quot;</span>
        <span class="p">],</span>
    <span class="p">}</span>
<span class="p">]</span>
</code></pre></div>

<h3 id="json-schema">JSON schema<a class="headerlink" href="#json-schema" title="Permanent link">&para;</a></h3>
<p>Tagged unions JSON schema use <code>oneOf</code> as expected.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">from</span> <span class="nn">apischema.json_schema</span> <span class="kn">import</span> <span class="n">deserialization_schema</span><span class="p">,</span> <span class="n">serialization_schema</span>
<span class="kn">from</span> <span class="nn">apischema.tagged_unions</span> <span class="kn">import</span> <span class="n">Tagged</span><span class="p">,</span> <span class="n">TaggedUnion</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Bar</span><span class="p">:</span>
    <span class="n">field</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">TaggedUnion</span><span class="p">):</span>
    <span class="n">bar</span><span class="p">:</span> <span class="n">Tagged</span><span class="p">[</span><span class="n">Bar</span><span class="p">]</span>
    <span class="n">baz</span><span class="p">:</span> <span class="n">Tagged</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>


<span class="k">assert</span> <span class="p">(</span>
    <span class="n">deserialization_schema</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span>
    <span class="o">==</span> <span class="n">serialization_schema</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span>
    <span class="o">==</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
        <span class="s2">&quot;oneOf&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">}},</span>
                        <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;field&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;baz&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">}}},</span>
        <span class="p">],</span>
        <span class="s2">&quot;$schema&quot;</span><span class="p">:</span> <span class="s2">&quot;http://json-schema.org/draft/2019-09/schema#&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>

<h3 id="graphql-schema">GraphQL schema<a class="headerlink" href="#graphql-schema" title="Permanent link">&para;</a></h3>
<p>As tagged union are not (yet?) part of the <em>GraphQL</em> spec, so they are just implemented as normal (input) object type with nullable fields. An error is raised if several tags are passed in input.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">from</span> <span class="nn">graphql</span> <span class="kn">import</span> <span class="n">graphql_sync</span>
<span class="kn">from</span> <span class="nn">graphql.utilities</span> <span class="kn">import</span> <span class="n">print_schema</span>

<span class="kn">from</span> <span class="nn">apischema.graphql</span> <span class="kn">import</span> <span class="n">graphql_schema</span>
<span class="kn">from</span> <span class="nn">apischema.tagged_unions</span> <span class="kn">import</span> <span class="n">Tagged</span><span class="p">,</span> <span class="n">TaggedUnion</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Bar</span><span class="p">:</span>
    <span class="n">field</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">TaggedUnion</span><span class="p">):</span>
    <span class="n">bar</span><span class="p">:</span> <span class="n">Tagged</span><span class="p">[</span><span class="n">Bar</span><span class="p">]</span>
    <span class="n">baz</span><span class="p">:</span> <span class="n">Tagged</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="n">foo</span><span class="p">:</span> <span class="n">Foo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Foo</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">foo</span>


<span class="n">schema</span> <span class="o">=</span> <span class="n">graphql_schema</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="p">[</span><span class="n">query</span><span class="p">])</span>
<span class="n">schema_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">type Query {</span>
<span class="s2">  query(foo: FooInput!): Foo!</span>
<span class="s2">}</span>

<span class="s2">type Foo {</span>
<span class="s2">  bar: Bar</span>
<span class="s2">  baz: Int</span>
<span class="s2">}</span>

<span class="s2">type Bar {</span>
<span class="s2">  field: String!</span>
<span class="s2">}</span>

<span class="s2">input FooInput {</span>
<span class="s2">  bar: BarInput</span>
<span class="s2">  baz: Int</span>
<span class="s2">}</span>

<span class="s2">input BarInput {</span>
<span class="s2">  field: String!</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="k">assert</span> <span class="n">print_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span> <span class="o">==</span> <span class="n">schema_str</span>

<span class="n">query_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">{</span>
<span class="s2">    query(foo: {bar: {field: &quot;value&quot;}}) {</span>
<span class="s2">        bar {</span>
<span class="s2">            field</span>
<span class="s2">        }</span>
<span class="s2">        baz</span>
<span class="s2">    }</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="k">assert</span> <span class="n">graphql_sync</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">query_str</span><span class="p">)</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;field&quot;</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span><span class="p">},</span>
        <span class="s2">&quot;baz&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../overview/" title="Overview" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Overview
              </div>
            </div>
          </a>
        
        
          <a href="../schema/" title="GraphQL schema" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                GraphQL schema
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.92ffa368.min.js"></script>
      <script src="../../assets/javascripts/bundle.5123e3d4.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.a68abb33.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>