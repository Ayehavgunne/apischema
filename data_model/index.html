


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.0">
    
    
      
        <title>Data model - Apischema</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.b5d04df8.min.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/palette.9ab2c1f8.min.css">
      
      
        
        
        <meta name="theme-color" content="#4caf50">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="green" data-md-color-accent="indigo">
  
    
      <script>matchMedia("(prefers-color-scheme: dark)").matches&&document.body.setAttribute("data-md-color-scheme","slate")</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#data-model" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Apischema" class="md-header-nav__button md-logo" aria-label="Apischema">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Apischema
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Data model
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/wyfo/apischema/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    wyfo/apischema
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Apischema" class="md-nav__button md-logo" aria-label="Apischema">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Apischema
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/wyfo/apischema/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    wyfo/apischema
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Data model
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Data model" class="md-nav__link md-nav__link--active">
      Data model
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pep-585" class="md-nav__link">
    PEP 585
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dataclasses" class="md-nav__link">
    Dataclasses
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#standard-library-types" class="md-nav__link">
    Standard library types
  </a>
  
    <nav class="md-nav" aria-label="Standard library types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#primitive" class="md-nav__link">
    Primitive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collection" class="md-nav__link">
    Collection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapping" class="md-nav__link">
    Mapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumeration" class="md-nav__link">
    Enumeration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#typing-facilities" class="md-nav__link">
    Typing facilities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-standard-library-types" class="md-nav__link">
    Other standard library types
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generic" class="md-nav__link">
    Generic
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recursive-types-string-annotations-and-pep-563" class="md-nav__link">
    Recursive types, string annotations and PEP 563
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#null-vs-undefined" class="md-nav__link">
    null vs undefined
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#annotated-pep-593" class="md-nav__link">
    Annotated - PEP 593
  </a>
  
    <nav class="md-nav" aria-label="Annotated - PEP 593">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#skip-union-member" class="md-nav__link">
    Skip Union member
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-vs-notnull" class="md-nav__link">
    Optional vs. NotNull
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skip-dataclass-field" class="md-nav__link">
    Skip dataclass field
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#composed-dataclasses-merging" class="md-nav__link">
    Composed dataclasses merging
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-types-orm" class="md-nav__link">
    Custom types / ORM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unsupported-types" class="md-nav__link">
    Unsupported types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#faq" class="md-nav__link">
    FAQ
  </a>
  
    <nav class="md-nav" aria-label="FAQ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-iterable-is-not-handled-with-other-collection-type" class="md-nav__link">
    Why Iterable is not handled with other collection type?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-happens-if-i-override-dataclass-__init__" class="md-nav__link">
    What happens if I override dataclass __init__?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../de_serialization/" title="(De)serialization" class="md-nav__link">
      (De)serialization
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../json_schema/" title="JSON schema" class="md-nav__link">
      JSON schema
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../validation/" title="Validation" class="md-nav__link">
      Validation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../conversions/" title="Conversions – (de)serialization customization" class="md-nav__link">
      Conversions – (de)serialization customization
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      GraphQL
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="GraphQL" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        GraphQL
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../graphql/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../graphql/data_model_and_resolvers/" title="Data model and resolvers" class="md-nav__link">
      Data model and resolvers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../graphql/schema/" title="Schema" class="md-nav__link">
      Schema
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Examples
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Examples" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../examples/open_rpc/" title="OpenRPC" class="md-nav__link">
      OpenRPC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../examples/sqlalchemy/" title="SQLAlchemy support" class="md-nav__link">
      SQLAlchemy support
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../examples/pydantic_compatibility/" title="*Pydantic* compatibility" class="md-nav__link">
      *Pydantic* compatibility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../examples/attrs_compatibility/" title="Attrs compatibility" class="md-nav__link">
      Attrs compatibility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../examples/subclasses_union/" title="Class as union of its subclasses" class="md-nav__link">
      Class as union of its subclasses
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../examples/recoverable_fields/" title="Recoverable fields" class="md-nav__link">
      Recoverable fields
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../benchmark/" title="Benchmark" class="md-nav__link">
      Benchmark
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://github.com/wyfo/apischema/releases" title="Releases" class="md-nav__link">
      Releases
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pep-585" class="md-nav__link">
    PEP 585
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dataclasses" class="md-nav__link">
    Dataclasses
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#standard-library-types" class="md-nav__link">
    Standard library types
  </a>
  
    <nav class="md-nav" aria-label="Standard library types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#primitive" class="md-nav__link">
    Primitive
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collection" class="md-nav__link">
    Collection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapping" class="md-nav__link">
    Mapping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enumeration" class="md-nav__link">
    Enumeration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#typing-facilities" class="md-nav__link">
    Typing facilities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#other-standard-library-types" class="md-nav__link">
    Other standard library types
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generic" class="md-nav__link">
    Generic
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recursive-types-string-annotations-and-pep-563" class="md-nav__link">
    Recursive types, string annotations and PEP 563
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#null-vs-undefined" class="md-nav__link">
    null vs undefined
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#annotated-pep-593" class="md-nav__link">
    Annotated - PEP 593
  </a>
  
    <nav class="md-nav" aria-label="Annotated - PEP 593">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#skip-union-member" class="md-nav__link">
    Skip Union member
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-vs-notnull" class="md-nav__link">
    Optional vs. NotNull
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#skip-dataclass-field" class="md-nav__link">
    Skip dataclass field
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#composed-dataclasses-merging" class="md-nav__link">
    Composed dataclasses merging
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-types-orm" class="md-nav__link">
    Custom types / ORM
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unsupported-types" class="md-nav__link">
    Unsupported types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#faq" class="md-nav__link">
    FAQ
  </a>
  
    <nav class="md-nav" aria-label="FAQ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-iterable-is-not-handled-with-other-collection-type" class="md-nav__link">
    Why Iterable is not handled with other collection type?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-happens-if-i-override-dataclass-__init__" class="md-nav__link">
    What happens if I override dataclass __init__?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/wyfo/apischema/edit/master/docs/data_model.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="data-model">Data model<a class="headerlink" href="#data-model" title="Permanent link">&para;</a></h1>
<p><em>Apischema</em> handle every classes/types you need.</p>
<p>By the way, it's done in an additive way, meaning that it doesn't affect your types.</p>
<h3 id="pep-585">PEP 585<a class="headerlink" href="#pep-585" title="Permanent link">&para;</a></h3>
<p>With Python 3.9 and <a href="https://www.python.org/dev/peps/pep-0585/">PEP 585</a>, typing is substantially shaken up; all collection types of <code>typing</code> module are now deprecated.</p>
<p>Apischema fully support 3.9 and PEP 585, as shown in the different examples.</p>
<h2 id="dataclasses">Dataclasses<a class="headerlink" href="#dataclasses" title="Permanent link">&para;</a></h2>
<p>Because the library aims to bring the minimum boilerplate, it's build on the top of standard library. <a href="https://docs.python.org/3/library/dataclasses.html">Dataclasses</a> are thus the core structure of the data model.</p>
<p>Dataclasses bring the possibility of field customization, with more than just a default value.
In addition to the common parameters of <a href="https://docs.python.org/3/library/dataclasses.html#dataclasses.field"><code>dataclasses.field</code></a>, customization is done with <code>metadata</code> parameter. </p>
<p>With some teasing of features presented later:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">alias</span><span class="p">,</span> <span class="n">schema</span>
<span class="kn">from</span> <span class="nn">apischema.metadata</span> <span class="kn">import</span> <span class="n">required</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;foo_bar&quot;</span><span class="p">)</span> <span class="o">|</span> <span class="n">schema</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;foo! bar!&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span> <span class="o">|</span> <span class="n">required</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Field's metadata are just an ordinary <code>dict</code>; <em>Apischema</em> provides some functions to enrich these metadata with it's own keys (<code>alias("foo_bar)</code> is roughly equivalent to `{"_apischema_alias": "foo_bar"}) and use them when the time comes, but metadata are not reserved to <em>Apischema</em> and other keys can be added.</p>
<p>Because <a href="https://www.python.org/dev/peps/pep-0584/">PEP 584</a> is painfully missing before Python 3.9, <em>Apischema</em> metadata use their own subclass of <code>dict</code> just to add <code>|</code> operator for convenience.</p>
</div>
<p>Dataclasses <code>__post_init__</code> and <code>field(init=False)</code> are fully supported. Implication of this feature usage is documented in the relative sections.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Before 3.8, <code>InitVar</code> is doing <a href="https://bugs.python.org/issue33569">type erasure</a>, that's why it's not possible for <em>Apischema</em> to retrieve type information of init variables. To fix this behavior, a field metadata <code>init_var</code> can be used to put back the type of the field (<code>init_var</code> also accepts stringified type annotations).</p>
</div>
<h2 id="standard-library-types">Standard library types<a class="headerlink" href="#standard-library-types" title="Permanent link">&para;</a></h2>
<p><em>Apischema</em> handle natively most of the types provided by the standard library. They are sorted in the following categories:</p>
<h4 id="primitive">Primitive<a class="headerlink" href="#primitive" title="Permanent link">&para;</a></h4>
<p><code>str</code>, <code>int</code>, <code>float</code>, <code>bool</code>, <code>None</code>, subclasses of them</p>
<p>They correspond to JSON primitive types.</p>
<h4 id="collection">Collection<a class="headerlink" href="#collection" title="Permanent link">&para;</a></h4>
<ul>
<li><code>collection.abc.Collection</code> (<em><code>typing.Collection</code></em>)</li>
<li><code>collection.abc.Sequence</code> (<em><code>typing.Sequence</code></em>)</li>
<li><code>tuple</code> (<em><code>typing.Tuple</code></em>)</li>
<li><code>collection.abc.MutableSequence</code> (<em><code>typing.MutableSequence</code></em>)</li>
<li><code>list</code> (<em><code>typing.List</code></em>)</li>
<li><code>collection.abc.Set</code> (<em><code>typing.AbstractSet</code></em>)</li>
<li><code>collection.abc.MutableSet</code> (<em><code>typing.MutableSet</code></em>)</li>
<li><code>frozenset</code> (<em><code>typing.FrozenSet</code></em>)</li>
<li><code>set</code> (<em><code>typing.Set</code></em>)</li>
</ul>
<p>They correspond to JSON <em>array</em> and are serialized to <code>list</code>.</p>
<p>Some of them are abstract; deserialization will instantiate a concrete child class. For example <code>collection.abc.Sequence</code> will be instantiated with <code>tuple</code> while <code>collection.MutableSequence</code> will be instantiated with <code>list</code>.</p>
<h4 id="mapping">Mapping<a class="headerlink" href="#mapping" title="Permanent link">&para;</a></h4>
<ul>
<li><code>collection.abc.Mapping</code> (<em><code>typing.Mapping</code></em>)</li>
<li><code>collection.abc.MutableMapping</code> (<em><code>typing.MutableMapping</code></em>)</li>
<li><code>dict</code> (<em><code>typing.Dict</code></em>)</li>
</ul>
<p>They correpond to JSON <em>object</em> and are serialized to <code>dict</code>.</p>
<h4 id="enumeration">Enumeration<a class="headerlink" href="#enumeration" title="Permanent link">&para;</a></h4>
<p><code>enum.Enum</code> subclasses, <code>typing.Literal</code></p>
<p>For <code>Enum</code>, this is the value and not the attribute name that is serialized</p>
<h4 id="typing-facilities">Typing facilities<a class="headerlink" href="#typing-facilities" title="Permanent link">&para;</a></h4>
<ul>
<li><code>typing.Optional</code>/<code>typing.Union</code> (<code>Optional[T]</code> is strictly equivalent to <code>Union[T, None]</code>)</li>
</ul>
<dl>
<dd>Deserialization select the first matching alternative (see below how to <a href="#skip-union-member">skip some union member</a>)</dd>
</dl>
<ul>
<li><code>tuple</code> (<em><code>typing.Tuple</code></em>)</li>
</ul>
<dl>
<dd>Can be used as collection as well as true tuple, like <code>tuple[str, int]</code></dd>
</dl>
<ul>
<li><code>typing.NewType</code></li>
</ul>
<dl>
<dd>Serialized according to its base type</dd>
</dl>
<ul>
<li><code>typing.TypedDict</code>, <code>typing.NamedTuple</code></li>
</ul>
<dl>
<dd>Kind of discount dataclass without field customization</dd>
</dl>
<ul>
<li><code>typing.Any</code></li>
</ul>
<dl>
<dd>Untouched by deserialization</dd>
</dl>
<h4 id="other-standard-library-types">Other standard library types<a class="headerlink" href="#other-standard-library-types" title="Permanent link">&para;</a></h4>
<ul>
<li><code>bytes</code></li>
</ul>
<dl>
<dd>with <code>str</code> (de)serialization using base64 encoding</dd>
</dl>
<ul>
<li><code>datetime.datetime</code></li>
<li><code>datetime.date</code></li>
<li><code>datetime.time</code></li>
</ul>
<dl>
<dd>Supported only in 3.7+ with <code>fromisoformat</code>/<code>isoformat</code></dd>
</dl>
<ul>
<li><code>Decimal</code></li>
</ul>
<dl>
<dd>With <code>float</code> (de)serialization</dd>
</dl>
<ul>
<li><code>ipaddress.IPv4Address</code> </li>
<li><code>ipaddress.IPv4Interface</code></li>
<li><code>ipaddress.IPv4Network</code></li>
<li><code>ipaddress.IPv6Address</code> </li>
<li><code>ipaddress.IPv6Interface</code></li>
<li><code>ipaddress.IPv6Network</code></li>
<li><code>pathlib.Path</code></li>
<li><code>re.Pattern</code> (<em><code>typing.Pattern</code></em>)</li>
<li><code>uuid.UUID</code></li>
</ul>
<dl>
<dd>With <code>str</code> (de)serialization</dd>
</dl>
<h2 id="generic">Generic<a class="headerlink" href="#generic" title="Permanent link">&para;</a></h2>
<p><code>typing.Generic</code> can be used out of the box like in the following example:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">raises</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">deserialize</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Box</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="n">content</span><span class="p">:</span> <span class="n">T</span>
    <span class="n">shaken</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>


<span class="k">assert</span> <span class="n">deserialize</span><span class="p">(</span><span class="n">Box</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;void&quot;</span><span class="p">})</span> <span class="o">==</span> <span class="n">Box</span><span class="p">(</span><span class="s2">&quot;void&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
    <span class="n">deserialize</span><span class="p">(</span><span class="n">Box</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span>
</code></pre></div>


<h2 id="recursive-types-string-annotations-and-pep-563">Recursive types, string annotations and PEP 563<a class="headerlink" href="#recursive-types-string-annotations-and-pep-563" title="Permanent link">&para;</a></h2>
<p>Recursive classes can be typed as they usually do, with or without <a href="https://www.python.org/dev/peps/pep-0563/">PEP 563</a>.
Here with string annotations:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">deserialize</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">child</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Node&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">assert</span> <span class="n">deserialize</span><span class="p">(</span><span class="n">Node</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;child&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}})</span> <span class="o">==</span> <span class="n">Node</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Node</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</code></pre></div>


<p>Here with PEP 563 (requires 3.7+)</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">deserialize</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">child</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Node</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">assert</span> <span class="n">deserialize</span><span class="p">(</span><span class="n">Node</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;child&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}})</span> <span class="o">==</span> <span class="n">Node</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Node</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</code></pre></div>


<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>To resolve annotations, <em>Apischema</em> uses <code>typing.get_type_hints</code>; this doesn't work really well when used on objects defined outside of global scope.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning (minor)</p>
<p>Currently, PEP 585 can have surprising behavior when used outside the box, see <a href="https://bugs.python.org/issue41370">bpo-41370</a></p>
</div>
<h2 id="null-vs-undefined"><code>null</code> vs <code>undefined</code><a class="headerlink" href="#null-vs-undefined" title="Permanent link">&para;</a></h2>
<p>Contrary to Javascript, Python doesn't have an <code>undefined</code> equivalent (if we consider <code>None</code> to be <code>null</code> equivalent). But it can be useful to distinguish (especially when thinkinn about HTTP <code>PATCH</code> method) between a <code>null</code> field and an <code>undefined</code>/absent field.</p>
<p>That's why <em>Apischema</em> provides an <code>Undefined</code> constant (a single instance of <code>UndefinedType</code> class) which can be used as a default value everywhere where this distinction is needed. In fact, default values are used when field are absent, thus a default <code>Undefined</code> will <em>mark</em> the field as absent. </p>
<p>Dataclass/<code>NamedTuple</code> fields are ignored by serialization when <code>Undefined</code>. </p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">Undefined</span><span class="p">,</span> <span class="n">UndefinedType</span><span class="p">,</span> <span class="n">deserialize</span><span class="p">,</span> <span class="n">serialize</span>
<span class="kn">from</span> <span class="nn">apischema.json_schema</span> <span class="kn">import</span> <span class="n">deserialization_schema</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">bar</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">UndefinedType</span><span class="p">]</span> <span class="o">=</span> <span class="n">Undefined</span>
    <span class="n">baz</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">UndefinedType</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">Undefined</span>


<span class="k">assert</span> <span class="n">deserialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span> <span class="o">==</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">deserialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="p">{})</span> <span class="o">==</span> <span class="n">Foo</span><span class="p">(</span><span class="n">Undefined</span><span class="p">,</span> <span class="n">Undefined</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">(</span><span class="n">Undefined</span><span class="p">,</span> <span class="mi">42</span><span class="p">))</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;baz&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">}</span>
<span class="c1"># Foo.bar and Foo.baz are not required</span>
<span class="k">assert</span> <span class="n">deserialization_schema</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s2">&quot;$schema&quot;</span><span class="p">:</span> <span class="s2">&quot;http://json-schema.org/draft/2019-09/schema#&quot;</span><span class="p">,</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
    <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">},</span> <span class="s2">&quot;baz&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;null&quot;</span><span class="p">]}},</span>
    <span class="s2">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>UndefinedType</code> must only be used inside an <code>Union</code>, as it has no sense as a standalone type. By the way, no suitable name was found to shorten <code>Union[T, UndefinedType]</code> but propositions are welcomed.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>Undefined</code> is a falsy constant, i.e. <code>bool(Undefined) is False</code>.</p>
</div>
<h2 id="annotated-pep-593">Annotated - PEP 593<a class="headerlink" href="#annotated-pep-593" title="Permanent link">&para;</a></h2>
<p><a href="https://www.python.org/dev/peps/pep-0593/">PEP 593</a> is fully supported; annotations stranger to <em>Apischema</em> are simlply ignored.</p>
<h3 id="skip-union-member">Skip <code>Union</code> member<a class="headerlink" href="#skip-union-member" title="Permanent link">&para;</a></h3>
<p>Sometimes, one of the <code>Union</code> members has not to be taken in account during validation; it can just be here to match the type of the default value of the field. This member can be marked as to be skipped with <a href="https://www.python.org/dev/peps/pep-0593/">PEP 593</a> <code>Annotated</code> and <code>apischema.skip.Skip</code></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">raises</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">deserialize</span><span class="p">,</span> <span class="n">serialize</span>
<span class="kn">from</span> <span class="nn">apischema.skip</span> <span class="kn">import</span> <span class="n">Skip</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">bar</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Annotated</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">Skip</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="n">deserialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
<span class="k">assert</span> <span class="n">serialize</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">],</span> <span class="s2">&quot;err&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;expected type integer, found null&quot;</span><span class="p">]}</span>
<span class="p">]</span>
</code></pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>Skip(schema_only=True)</code> can also be used to skip the member only for <a href="../json_schema/">JSON schema generation</a></p>
</div>
<h3 id="optional-vs-notnull">Optional vs. NotNull<a class="headerlink" href="#optional-vs-notnull" title="Permanent link">&para;</a></h3>
<p><code>Optional</code> type is not always appropriate, because it allows deserialized value to be <code>null</code>, but sometimes, you just want <code>None</code> as a default value for unset fields, not an authorized one.</p>
<p>That's why <em>Apischema</em> defines a <code>NotNull</code> type; in fact, <code>NotNull = Union[T, Annotated[None, Skip]]</code>. </p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">raises</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">deserialize</span><span class="p">,</span> <span class="n">serialize</span>
<span class="kn">from</span> <span class="nn">apischema.skip</span> <span class="kn">import</span> <span class="n">NotNull</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="c1"># NotNull is exactly like Optional for type checkers,</span>
    <span class="c1"># it&#39;s only interpreted differently by Apischema</span>
    <span class="n">bar</span><span class="p">:</span> <span class="n">NotNull</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="n">deserialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
<span class="k">assert</span> <span class="n">serialize</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">],</span> <span class="s2">&quot;err&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;expected type integer, found null&quot;</span><span class="p">]}</span>
<span class="p">]</span>
</code></pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can also use <a href="#null-vs-undefined"><code>Undefined</code></a>, but it can be more convenient to directly manipulate an <code>Optional</code> field, especially in the rest of the code unrelated to (de)serialization.</p>
<p><a href="../de_serialization/#fields-set">Fields set feature</a> can be used to avoid unwanted serialization of a <code>None</code> default value of a <code>NotNull</code> field. </p>
</div>
<h2 id="skip-dataclass-field">Skip dataclass field<a class="headerlink" href="#skip-dataclass-field" title="Permanent link">&para;</a></h2>
<p>Dataclass fields can be excluded from <em>Apischema</em> processing by using <code>apischema.metadata.skip</code> in the field metadata</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>

<span class="kn">from</span> <span class="nn">apischema.json_schema</span> <span class="kn">import</span> <span class="n">deserialization_schema</span>
<span class="kn">from</span> <span class="nn">apischema.metadata</span> <span class="kn">import</span> <span class="n">skip</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">baz</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;baz&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">skip</span><span class="p">)</span>


<span class="k">assert</span> <span class="n">deserialization_schema</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s2">&quot;$schema&quot;</span><span class="p">:</span> <span class="s2">&quot;http://json-schema.org/draft/2019-09/schema#&quot;</span><span class="p">,</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
    <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">}},</span>
    <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">],</span>
    <span class="s2">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>   
</code></pre></div>


<h2 id="composed-dataclasses-merging">Composed dataclasses merging<a class="headerlink" href="#composed-dataclasses-merging" title="Permanent link">&para;</a></h2>
<p>Dataclass fields which are themselves dataclass can be "merged" into the owning one by using <code>merged</code> metadata. Then, when the class will be (de)serialized, "merged" fields will be (de)serialized at the same level than the owning class.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">Undefined</span><span class="p">,</span> <span class="n">UndefinedType</span><span class="p">,</span> <span class="n">alias</span><span class="p">,</span> <span class="n">deserialize</span><span class="p">,</span> <span class="n">serialize</span>
<span class="kn">from</span> <span class="nn">apischema.fields</span> <span class="kn">import</span> <span class="n">with_fields_set</span>
<span class="kn">from</span> <span class="nn">apischema.json_schema</span> <span class="kn">import</span> <span class="n">deserialization_schema</span>
<span class="kn">from</span> <span class="nn">apischema.metadata</span> <span class="kn">import</span> <span class="n">merged</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">JsonSchema</span><span class="p">:</span>
    <span class="n">title</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">UndefinedType</span><span class="p">]</span> <span class="o">=</span> <span class="n">Undefined</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">UndefinedType</span><span class="p">]</span> <span class="o">=</span> <span class="n">Undefined</span>
    <span class="nb">format</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">UndefinedType</span><span class="p">]</span> <span class="o">=</span> <span class="n">Undefined</span>
    <span class="o">...</span>


<span class="nd">@with_fields_set</span>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RootJsonSchema</span><span class="p">:</span>
    <span class="n">schema</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">UndefinedType</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="n">Undefined</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;$schema&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">defs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">JsonSchema</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;$defs&quot;</span><span class="p">))</span>
    <span class="c1"># This field schema is merged inside the owning one</span>
    <span class="n">json_schema</span><span class="p">:</span> <span class="n">JsonSchema</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">JsonSchema</span><span class="p">(),</span> <span class="n">metadata</span><span class="o">=</span><span class="n">merged</span><span class="p">)</span>


<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;$schema&quot;</span><span class="p">:</span> <span class="s2">&quot;http://json-schema.org/draft/2019-09/schema#&quot;</span><span class="p">,</span>
    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;merged example&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">root_schema</span> <span class="o">=</span> <span class="n">RootJsonSchema</span><span class="p">(</span>
    <span class="n">schema</span><span class="o">=</span><span class="s2">&quot;http://json-schema.org/draft/2019-09/schema#&quot;</span><span class="p">,</span>
    <span class="n">json_schema</span><span class="o">=</span><span class="n">JsonSchema</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;merged example&quot;</span><span class="p">),</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="n">deserialize</span><span class="p">(</span><span class="n">RootJsonSchema</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="n">root_schema</span>
<span class="k">assert</span> <span class="n">serialize</span><span class="p">(</span><span class="n">root_schema</span><span class="p">)</span> <span class="o">==</span> <span class="n">data</span>
<span class="k">assert</span> <span class="n">deserialization_schema</span><span class="p">(</span><span class="n">RootJsonSchema</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s2">&quot;$schema&quot;</span><span class="p">:</span> <span class="s2">&quot;http://json-schema.org/draft/2019-09/schema#&quot;</span><span class="p">,</span>
    <span class="s2">&quot;$defs&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;JsonSchema&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">},</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">},</span>
                <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">},</span>
            <span class="p">},</span>
            <span class="s2">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
    <span class="c1"># It results in allOf + unevaluatedProperties=False</span>
    <span class="s2">&quot;allOf&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1"># RootJsonSchema (without JsonSchema)</span>
        <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
            <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;$schema&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">},</span>
                <span class="s2">&quot;$defs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;array&quot;</span><span class="p">,</span> <span class="s2">&quot;items&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$ref&quot;</span><span class="p">:</span> <span class="s2">&quot;#/$defs/JsonSchema&quot;</span><span class="p">}},</span>
            <span class="p">},</span>
            <span class="s2">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="c1"># JonsSchema</span>
        <span class="p">{</span><span class="s2">&quot;$ref&quot;</span><span class="p">:</span> <span class="s2">&quot;#/$defs/JsonSchema&quot;</span><span class="p">},</span>
    <span class="p">],</span>
    <span class="s2">&quot;unevaluatedProperties&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This feature use JSON schema draft 2019-09 <a href="https://json-schema.org/draft/2019-09/json-schema-core.html#unevaluatedProperties"><code>unevaluatedProperties</code> keyword</a>. However, this keyword is removed when JSON schema is converted in a version that doesn't support it, like OpenAPI 3.0.</p>
</div>
<p>This feature is very convenient for building model by composing smaller components. If some kind of reuse could also be achieved with inheritance, it can be less practical when it comes to use it in code, because there is no easy way to build an inherited class when you have an instance of the super class ; you have to copy all the fields by hand. On the other hand, using composition (of merged fields), it's easy to instantiate the class when the smaller component is just a field of it.</p>
<h2 id="custom-types-orm">Custom types / ORM<a class="headerlink" href="#custom-types-orm" title="Permanent link">&para;</a></h2>
<p>See <a href="../conversions/">conversion</a> in order to support every possible types in a few lines of code.</p>
<h2 id="unsupported-types">Unsupported types<a class="headerlink" href="#unsupported-types" title="Permanent link">&para;</a></h2>
<p>When <em>Apischema</em> encounters a type that it doesn't support, <code>Unsupported</code> exception will be raised.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">raises</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">Unsupported</span><span class="p">,</span> <span class="n">deserialize</span><span class="p">,</span> <span class="n">serialize</span>


<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="n">Unsupported</span><span class="p">):</span>
    <span class="n">deserialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="p">{})</span>
<span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="n">Unsupported</span><span class="p">):</span>
    <span class="n">serialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">())</span>
</code></pre></div>


<p>See <a href="../conversions/">conversion</a> section to make <em>Apischema</em> support all your classes.</p>
<h2 id="faq">FAQ<a class="headerlink" href="#faq" title="Permanent link">&para;</a></h2>
<h4 id="why-iterable-is-not-handled-with-other-collection-type">Why <code>Iterable</code> is not handled with other collection type?<a class="headerlink" href="#why-iterable-is-not-handled-with-other-collection-type" title="Permanent link">&para;</a></h4>
<p>Iterable could be handled (actually, it was at the beginning), however, this doesn't really make sense from a data point of view. Iterable are computation objects, they can be infinite, etc. They don't correspond to a serialized data; <code>Collection</code> is way more appropriate in this context.</p>
<h4 id="what-happens-if-i-override-dataclass-__init__">What happens if I override dataclass <code>__init__</code>?<a class="headerlink" href="#what-happens-if-i-override-dataclass-__init__" title="Permanent link">&para;</a></h4>
<p><em>Apischema</em> always assumes that dataclass <code>__init__</code> can be called with with all its fields as kwargs parameters. If that's no more the case after a modification of <code>__init__</code> (what means if an exception is thrown when the constructor is called because of bad parameters), <em>Apischema</em> treats then the class as <a href="#unsupported-types">not supported</a>.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href=".." title="Overview" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Overview
              </div>
            </div>
          </a>
        
        
          <a href="../de_serialization/" title="(De)serialization" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                (De)serialization
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.92ffa368.min.js"></script>
      <script src="../assets/javascripts/bundle.5123e3d4.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.a68abb33.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>